<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>  Data Science - Data Science for Everyone</title>
<meta name="description" content="What is data science?">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_UK">
<meta property="og:site_name" content="Data Science for Everyone">
<meta property="og:title" content="  Data Science">
<meta property="og:url" content="https://matthew-brett.github.io/dsfe/chapters/01/what-is-data-science">


  <meta property="og:description" content="What is data science?">







  <meta property="article:published_time" content="2019-02-01T00:42:25+00:00">





  

  


<link rel="canonical" href="https://matthew-brett.github.io/dsfe/chapters/01/what-is-data-science">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Matthew Brett",
      "url": "https://matthew-brett.github.io/dsfe",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/dsfe/feed.xml" type="application/atom+xml" rel="alternate" title="Data Science for Everyone Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/dsfe/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->


<!-- end custom head snippets -->

    <link rel="stylesheet" href="/dsfe/assets/css/notebook-markdown.css">
    <link rel="stylesheet" href="/dsfe/assets/css/custom.css">
    <link rel="shortcut icon" type="image/png" href="/dsfe/favicon.png">
    <script src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js"></script>
  </head>

  <body class="layout--textbook">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

    <div class="initial-content">
      



<div id="main" class="textbook" role="main">
  <div id="textbook_wrapper">
    
  <div class="sidebar sticky textbook">
  
  
    <img src="/dsfe/images/dsfe_logo.png" class="textbook_logo" />
    

    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

          <a href="/dsfe/"><span class="nav__sub-title">Home</span></a>
        

        
      </li>
    
      <li>
        
          
          

          <a href="/dsfe/chapters/01/what-is-data-science"><span class="nav__sub-title">1. Data Science</span></a>
        

        
        <ul>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/01/intro" class="level_1">1.1 Introduction</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/01/computational-tools" class="level_2">1.1.1 Computational Tools</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/01/statistical-techniques" class="level_2">1.1.2 Statistical Techniques</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/01/why-data-science" class="level_1">1.2 Why Data Science?</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/01/Plotting_the_Classics" class="level_1">1.3 Plotting the Classics</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/01/Literary_Characters" class="level_2">1.3.1 Literary Characters</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/01/Another_Kind_Of_Character" class="level_2">1.3.2 Another Kind of Character</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/dsfe/chapters/02/to_code"><span class="nav__sub-title">2. Programming</span></a>
        

        
        <ul>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/02/sampling_problem" class="level_1">2.1 A sampling problem</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/02/three_girls" class="level_1">2.2 A simpler problem</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/02/Expressions" class="level_1">2.3 Expressions</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/02/variables" class="level_1">2.4 Variables</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/02/Names" class="level_1">2.5 Names</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/02/Calls" class="level_1">2.6 Call expressions</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/dsfe/chapters/03/data_types"><span class="nav__sub-title">3. Data types</span></a>
        

        
        <ul>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/03/Numbers" class="level_1">3.1 Numbers</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/03/Strings" class="level_1">3.2 Strings</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/03/Comparison" class="level_1">3.3 Comparison</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/03/Arrays" class="level_1">3.4 Arrays</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/03/Ranges" class="level_1">3.5 Ranges</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/03/More_on_Arrays" class="level_1">3.6 More on arrays</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/03/arrays_and_axes" class="level_1">3.7 Arrays and axes</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/03/reply_supreme" class="level_1">3.8 Reply to the Supreme Court</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/03/three_girls" class="level_1">3.9 Revision - three girls</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/03/array_indexing" class="level_1">3.10 Selecting with arrays</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/dsfe/chapters/04/data_frames"><span class="nav__sub-title">4. Data frames</span></a>
        

        
        <ul>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/04/data_frame_intro" class="level_1">4.1 Introduction to data frames</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/dsfe/chapters/05/permutation"><span class="nav__sub-title">5. Permutations</span></a>
        

        
        <ul>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/05/population_permutation" class="level_1">5.1 Population and permutation</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/05/lists" class="level_1">5.2 lists</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/05/iteration" class="level_1">5.3 Iteration with For loops</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/05/indentation" class="level_1">5.4 Indentation, indentation</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/05/ones_zeros" class="level_1">5.5 Ones and zeros</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/05/brexit_ages" class="level_1">5.6 Brexit ages</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/dsfe/chapters/06/more_simulation"><span class="nav__sub-title">6. More on simulation</span></a>
        

        
        <ul>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/06/sorting_arrays" class="level_1">6.1 Sorting arrays</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/06/monty_hall" class="level_1">6.2 Monty hall problem</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/dsfe/chapters/07/more_building_blocks"><span class="nav__sub-title">7. More building blocks</span></a>
        

        
        <ul>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/07/none" class="level_1">7.2 None</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/07/functions" class="level_1">7.1 Functions</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/07/conditional_statements" class="level_1">7.2 Conditional statements</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/dsfe/chapters/exercises/exercises"><span class="nav__sub-title">Exercises</span></a>
        

        
        <ul>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/exercises/simulation" class="level_1">Simulation</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/exercises/df_exercises" class="level_1">Data frames</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/exercises/brexit_analysis" class="level_1">Brexit analysis</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/exercises/for_loops" class="level_1">For loops</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/exercises/money_and_death" class="level_1">Money and death</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/exercises/function_exercises" class="level_1">Function exercises</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/dsfe/chapters/extra/extra"><span class="nav__sub-title">Extra pages</span></a>
        

        
        <ul>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/extra/more_on_lists" class="level_1">More on lists</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/extra/monty_hall_lists" class="level_1">Monty Hall with lists</a></li>
          
            
            

            
            

            

            <li><a href="/dsfe/chapters/extra/data8_functions" class="level_1">Berkeley introduction to functions</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    

  
  </div>


    <article class="page textbook" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="headline" content="  Data Science">
      <meta itemprop="description" content="What is data science?">
      <meta itemprop="datePublished" content="February 01, 2019">
      

      <div class="page__inner-wrap">
        
          <header>
            <h1 id="page-title" class="page__title" itemprop="headline"><ol>
  <li>Data Science</li>
</ol>
</h1>
          </header>
        

        <section class="page__content" itemprop="text">
          
            

<!-- TOC will only show up if it has at least one item -->


  <aside class="sidebar__right">
    <nav class="toc">
      <header><h4 class="nav__title"><i class="fas fa-list-ul"></i>   On this page</h4></header>
      <ul class="toc__menu">
  <li><a href="#does-data-science-matter">Does data science matter?</a></li>
  <li><a href="#the-origins-of-data-science">The origins of data science</a></li>
  <li><a href="#a-new-culture">A new culture</a></li>
  <li><a href="#whats-new-in-data-science">What’s new in data science?</a></li>
  <li><a href="#why-now">Why now?</a></li>
  <li><a href="#elements-of-data-science">Elements of data science</a></li>
  <li><a href="#conclusion">Conclusion</a></li>
  <li><a href="#references">References</a></li>
</ul>
    </nav>
  </aside>


          
          <!-- INTERACT LINKS -->


          <h1 id="what-is-data-science">What is data science?</h1>

<p>The combination of the words <em>data</em> and <em>science</em> do not give much hint as to what <em>data science</em> might mean.  Most science has data, and most work in science is analyzing data.</p>

<p>Because the name <em>data science</em> can cover such a broad range of subjects, it
has proved difficult to define.</p>

<p>We can make the definition very broad.  For example, the UC Berkeley data
science textbook has <a href="https://www.inferentialthinking.com/chapters/01/what-is-data-science">this
definition</a></p>

<blockquote>
  <p>Data Science is about drawing useful conclusions from large and diverse data
sets through exploration, prediction, and inference.</p>
</blockquote>

<p>As you will see, we do not think this very broad definition captures what is
really new in the data science movement.  We prefer to define data science as
a new <em>culture</em> of data analysis - like this:</p>

<blockquote>
  <p>Data science is a modern approach to data analysis with a foundation in code
and algorithms.</p>
</blockquote>

<p>Why do we choose this definition?  And does it matter?</p>

<p>We start with the second question.  If data science is important, then we need
the right definition in order to chose what we do and teach.</p>

<h2 id="does-data-science-matter">Does data science matter?</h2>

<p>Even if data science is hard to define, it has significant influence
in planning for education, and science.</p>

<p>David Donoho is an eminent statistician at Stanford University.  He
recently wrote an article reflecting on data science, how it was
defined, and what it could mean.  He was worried that data science
would be defined in a narrow way, in terms of big data and machine
learning. He was worried because he thought that data science was
important - that it should be:</p>

<blockquote>
  <p>… the really important intellectual event of the next fifty years.</p>
</blockquote>

<p><a href="#donoho201550">(Donoho, 2015)</a></p>

<p>For Donoho, data science is the rediscovery of the powerful methods of data
exploration and analysis used and taught by statisticians such as John W. Tukey
<a href="#tukey1962future">(Tukey, 1962)</a>.  These methods will be revolutionary for the future
of data analysis.</p>

<p>Meanwhile, educators, especially in the United States, have concluded that data
science techniques are fundamental to the future of education.   A 2018 report
of the National Academies of Science Engineering and Medicine recommended that:</p>

<blockquote>
  <p>… academic institutions should encourage the development of a basic
understanding of data science in all undergraduates</p>
</blockquote>

<p><a href="#natacad2018ds">(National Academies of Sciences &amp; Medicine, 2018)</a></p>

<h2 id="the-origins-of-data-science">The origins of data science</h2>

<p>The phrase “data science” has been around for a long time <a href="#press2013history">(Press, 2013)</a> but we argue that the term in its current use is very
recent.  As it is currently used, the phrase “data science” comes from the job
title “data scientist”, and the job title came from the tech industry.  D.J.
Patil, at LinkedIn, and Jeff Hammerbacher, at Facebook, noticed that they had
a “new breed” of data analysts - these were scientists who could code. Thomas
Davenport and Patil later described this phenomenon in a famous article “Data
Scientist: The Sexiest Job of the 21st Century” <a href="#davenport2012data">(Davenport &amp; Patil, 2012)</a>.
One section of the article is “Who are these people”:</p>

<blockquote>
  <p>… what data scientists do is make discoveries while swimming in data …
At ease in the digital realm, they are able to bring structure to large
quantities of formless data and make analysis possible. … Data scientists’
most basic, universal skill is the ability to write code.</p>
</blockquote>

<p>Most had come to code through their scientific work:</p>

<blockquote>
  <p>Some of the best and brightest data scientists are PhDs in esoteric fields
like ecology and systems biology. George Roumeliotis, the head of a data
science team at Intuit in Silicon Valley, holds a doctorate in astrophysics.</p>
</blockquote>

<p>These people needed a new job title, because they were so much more effective
than other data analysts.  Because they could code, they were able to analyze a
much wider range of data, and they could build programs to do difficult tasks
such as the analysis of big data sets.</p>

<p>Soon after these articles, data scientist started to become a very valuable job
title, with many companies competing to find people who could do this work.</p>

<h2 id="a-new-culture">A new culture</h2>

<p>Data scientists in industry were not doing anything new, in an academic sense.
They were applying skills that they had learned in academia.  Central to these
skills was the ability to build analyses in code.  It turned out that doing
this led naturally to many of the powerful practices discovered and described
by statisticians like John W. Tukey <a href="#tukey1962future">(Tukey, 1962)</a> and Leo Breiman
<a href="#breiman2001statistical">(Breiman, 2001)</a>.</p>

<h2 id="whats-new-in-data-science">What’s new in data science?</h2>

<p>What are these practices, that make data scientists in so effective in industry and academia?</p>

<p>The foundation is code.  At heart, the novelty in the work of data scientists is not novelty at all - it is just the discovery that being able to use code makes a huge difference to the analyses that you can do, and the conclusions that you can draw. Analysis based on code is:</p>

<ul>
  <li>Versatile.  Code allows us to analyze big, messy, mixed, and
complex data - put more simply, it allows us to analyze real
data.</li>
  <li>Realistic.  The real work of analysis is working with real data.
Much of this work is cleaning, reorganizing, collating and
exploring.  It is both complex and repetitive; it can only be done
effectively with code.  If you can code, then you can do this
work, describe it, and teach it.</li>
  <li>Collaborative.  Programmers have been working for many years on
methods for effective collaboration.  Data scientists learn these
methods, and apply them, so they become more transparent, more
efficient, and better at working together in teams.</li>
  <li>Reproducible.  Much analysis that does not use code, uses
graphical interfaces.  These are famous for making it difficult to
record your analysis, or describe it to someone else.  Analyses
based on code are naturally reproducible, because you can run the
code again, to produce the same result, and you can give someone
your code, so they can do the same thing.</li>
  <li>Easier to understand.  Coding allows us to shift our emphasis from
the relatively difficult mathematics behind the old-school
statistical tests, such as t-test and ANOVA, to more direct
methods such as resampling, including permutation tests and
bootstrap estimation.  Code gives us a language to describe these
methods in a simple and direct way, and this
makes the ideas clearer and easier to generalize.</li>
</ul>

<h2 id="why-now">Why now?</h2>

<p>Donoho and others have pointed out that much of what is distinctive in the new
culture of data analysis was already part of the analysis described by John W.
Tukey, in the mid-20th century.  Why have these methods only now started to
take hold?   We believe it is largely to do with the advances in the tools of
scientific computing.  Over the last 20 years we have seen the growth of a new
generation of programming languages with clear, powerful syntax, such as
Python.  Another language widely used in data science is R, the statistical
programming language. The originators of R were thinking specifically of data
analysis when designing the language.  Python and R are free, and open source,
so they have benefited from the explosion of productivity in <a href="https://en.wikipedia.org/wiki/Open-source_software_development">open-source
software</a>.  As
these languages have developed, they have attracted more scientist-programmers,
who build new libraries for data analysis and statistics.  Meanwhile
programmers in industry have learned the hard way, how difficult it can be to
write clear and effective code, and there is a substantial body of thought and
practice on process for writing and sharing code.  This process spread into the
world of open-source programming, leading to a great increase in the quality
and efficiency of academic code.  The combination of richer, clearer languages,
better libraries, and better working process have made it possible to do much
more with code than was previously possible.  As a result, many more scientists
can write good code, and therefore, many more scientists use code for data
analysis.  Eventually, these scientists appeared in companies that had
difficult problems in data analysis, and showed how effective these skills
could be.  These were the data scientists described by Patil and Hammerbacher.</p>

<h2 id="elements-of-data-science">Elements of data science</h2>

<p>If we are right, then data science is defined by what data scientists
do.  What do do they do?</p>

<ul>
  <li>They collate data from many sources;</li>
  <li>They clean up messy data, and use it to try to recover meaningful
information.  But they are sceptical, and know when the data cannot
be trusted for strong conclusions.</li>
  <li>They explore data, to find errors, and unexpected patterns.  They
will likely use different ways to make graphs and graphics from the
data, to diagnose and summarize.</li>
  <li>They work hard to understand the process that generated the data, to
make their conclusions meaningful.</li>
  <li>They understand variation, and the problems and limitations for
drawing conclusions from noisy and incomplete data.</li>
  <li>They often try and predict what new data will look like, from old
data.  They will use old and new methods to do this, including
methods from machine learning and statistics.</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>Data science is new, and we are still working out what it is. At the
moment, it is best defined by what a data scientist does. A data
scientist uses programming as the basis for a deeper, more flexible
approach to data analysis.</p>

<h2 id="references">References</h2>

<ol class="bibliography"><li><span id="donoho201550">Donoho, D. (2015). 50 years of Data Science. In <i>Princeton NJ, Tukey Centennial Workshop</i>. Retrieved from http://courses.csail.mit.edu/18.337/2015/docs/50YearsDataScience.pdf</span></li>
<li><span id="tukey1962future">Tukey, J. W. (1962). The future of data analysis. <i>The Annals of Mathematical Statistics</i>, <i>33</i>(1), 1–67. Retrieved from http://projecteuclid.org/euclid.aoms/1177704711</span></li>
<li><span id="natacad2018ds">National Academies of Sciences, E., &amp; Medicine. (2018). <i>Data Science for Undergraduates: Opportunities and Options</i>. Washington, DC: The National Academies Press. https://doi.org/10.17226/25104</span></li>
<li><span id="press2013history">Press, G. (2013). A Very Short History Of Data Science. Forbes. Retrieved from https://www.forbes.com/sites/gilpress/2013/05/28/a-very-short-history-of-data-science</span></li>
<li><span id="davenport2012data">Davenport, T. H., &amp; Patil, D. J. (2012). Data scientist: the sexiest job of the 21st century. <i>Harvard Business Review</i>, <i>90</i>(10), 70–76. Retrieved from https://hbr.org/2012/10/data-scientist-the-sexiest-job-of-the-21st-century</span></li>
<li><span id="breiman2001statistical">Breiman, L. (2001). Statistical modeling: The two cultures (with comments and a rejoinder by the author). <i>Statistical Science</i>, <i>16</i>(3), 199–231. Retrieved from https://projecteuclid.org/euclid.ss/1009213726</span></li></ol>

          
        </section>

        <footer class="page__meta">
          
          


        </footer>

        

        
  <nav class="pagination">
    
      <a href="" class="pagination--pager" title="
">Previous</a>
    
    
      <a href="/dsfe/chapters/01/intro" class="pagination--pager" title="1.1 Introduction
">Next</a>
    
  </nav>


      </div>

      
    </article>
  </div>
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><input type="text" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    <div id="results" class="results"></div></div>
      </div>
    

    

    
  <script src="/dsfe/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>




<script src="/dsfe/assets/js/lunr/lunr.min.js"></script>
<script src="/dsfe/assets/js/lunr/lunr-store.js"></script>
<script src="/dsfe/assets/js/lunr/lunr-en.js"></script>




    <!-- Custom scripts to load after site JS is loaded -->

    <!-- Custom HTML used for the textbooks -->
<!-- Configure, then load MathJax -->
<script type="text/javascript">
  window.MathJax = {
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true,
      processEnvironments: true
    }
  };
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML-full,Safe" type="text/javascript"></script>


<script type="text/javascript">
// --- To auto-embed hub URLs in interact links if given in a RESTful fashion ---
function getJsonFromUrl(url) {
  var query = url.split('?');
  if (query.length < 2) {
    // No queries so just return false
    return false;
  }
  query = query[1];
  // Collect REST params into a dictionary
  var result = {};
  query.split("&").forEach(function(part) {
    var item = part.split("=");
    result[item[0]] = decodeURIComponent(item[1]);
  });
  return result;
}

// Parse a Binder URL, converting it to the string needed for JupyterHub
function binder2Jupyterhub(url) {
  newUrl = {};
  parts = url.split('v2/gh/')[1];
  // Grab the base repo information
  repoinfo = parts.split('?')[0];
  var [org, repo, ref] = repoinfo.split('/');
  newUrl['repo'] = ['https://github.com', org, repo].join('/');
  newUrl['branch'] = ref
  // Grab extra parameters passed
  params = getJsonFromUrl(url);
  if (params['filepath'] !== undefined) {
    newUrl['subPath'] = params['filepath']
  }
  return jQuery.param(newUrl);
}

// Filter out potentially unsafe characters to prevent xss
function safeUrl(url)
{
   return String(encodeURIComponent(url))
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
}

function addParamToInternalLinks(hub) {
  var links = $("a").each(function() {
    var href = this.href;
    // If the link is an internal link...
    if (href.search("https://matthew-brett.github.io") !== -1 || href.startsWith('/') || href.search("127.0.0.1:") !== -1) {
      // Assume we're an internal link, add the hub param to it
      var params = getJsonFromUrl(href);
      if (params !== false) {
        // We have REST params, so append a new one
        params['hub'] = hub;
      } else {
        // Create the REST params
        params = {'hub': hub};
      }
      // Update the link
      var newHref = href.split('?')[0] + '?' + jQuery.param(params);
      this.setAttribute('href', decodeURIComponent(newHref));
    }
  });
  return false;
}

  // Update interact links
function updateInteractLink() {
    // hack to make this work since it expects a ? in the URL
    rest = getJsonFromUrl("?" + location.search.substr(1));
    hubUrl = rest['hub'];
    if (hubUrl !== undefined) {
      // Sanitize the hubUrl
      hubUrl = safeUrl(hubUrl);
      // Add HTTP text if omitted
      if (hubUrl.indexOf('http') < 0) {hubUrl = 'http://' + hubUrl;}
      link = $("a.interact-button")[0];
      if (link !== undefined) {
          // Update the interact link URL
          var href = link.getAttribute('href');
          if ('binder' == 'binder') {
            // If binder links exist, we need to re-work them for jupyterhub
            first = [hubUrl, 'hub', 'user-redirect', 'git-sync'].join('/')
            href = first + '?' + binder2Jupyterhub(href);
          } else {
            // If JupyterHub links, we only need to replace the hub url
            href = href.replace("https://mybinder.org", hubUrl);
          }
          link.setAttribute('href', decodeURIComponent(href));

          // Add text after interact link saying where we're launching
          hubUrlNoHttp = decodeURIComponent(hubUrl).replace('http://', '').replace('https://', '');
          $("a.interact-button").after($('<div class="interact-context">on ' + hubUrlNoHttp + '</div>'));

      }
      // Update internal links so we retain the hub url
      addParamToInternalLinks(hubUrl);
    }
}

// --- Highlight the part of sidebar for current page ---

// helper to replace trailing slash
function replaceSlash(string)
{
    return string.replace(/\/$/, "");
}

// Add a class to the current page in the sidebar
function highlightSidebarCurrentPage()
{
  var currentpage = location.href;
  var links = $('.sidebar .nav__items a');
  var ii = 0;
  for(ii; ii < links.length; ii++) {
    var link = links[ii];
    if(replaceSlash(link.href) == replaceSlash(currentpage)) {
      // Add CSS for styling
      link.classList.add("current");
      // Scroll to this element
      $('div.sidebar').scrollTop(link.offsetTop - 300);
    }
  }
}

// --- Set up copy/paste for code blocks ---
function addCopyButtonToCode(){
  // get all <code> elements
  var allCodeBlocksElements = $( "div.input_area code, div.highlighter-rouge code" );

  allCodeBlocksElements.each(function(ii) {
   	// add different id for each code block

  	// target
    var currentId = "codeblock" + (ii + 1);
    $(this).attr('id', currentId);

    //trigger
    var clipButton = '<button class="btn copybtn" data-clipboard-target="#' + currentId + '"><img src="https://clipboardjs.com/assets/images/clippy.svg" width="13" alt="Copy to clipboard"></button>';
       $(this).after(clipButton);
    });

    new Clipboard('.btn');
}

// Run scripts when page is loaded
$(document).ready(function () {
  // Add anchors to H1 etc links
  anchors.add();
  // Highlight current page in sidebar
  highlightSidebarCurrentPage();
  // Add copy button to code blocks
  addCopyButtonToCode();
  // Update the Interact link if a REST param given
  updateInteractLink();
});
</script>

  </body>
</html>
